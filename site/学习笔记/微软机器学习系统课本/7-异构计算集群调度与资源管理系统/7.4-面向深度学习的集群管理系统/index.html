
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.3.8">
    
    
      
        <title>7.4-面向深度学习的集群管理系统 - My Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#74" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="My Docs" class="md-header__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            My Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              7.4-面向深度学习的集群管理系统
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        Home
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Python%E8%AF%AD%E8%A8%80/Python%E7%9A%84C%E6%8B%93%E5%B1%95/" class="md-tabs__link md-tabs__link--active">
        学习笔记
      </a>
    </li>
  

  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="My Docs" class="md-nav__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    My Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Home
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Home" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Home
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          学习笔记
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="学习笔记" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          学习笔记
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" type="checkbox" id="__nav_2_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1">
          深入理解Python语言
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="深入理解Python语言" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          深入理解Python语言
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Python%E8%AF%AD%E8%A8%80/Python%E7%9A%84C%E6%8B%93%E5%B1%95/" class="md-nav__link">
        Python的C拓展
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_2">
          Cuda
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Cuda" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Cuda
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Cuda/Gemm%E4%BC%98%E5%8C%96/" class="md-nav__link">
        Gemm优化
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Cuda/%E7%BA%BF%E7%A8%8B%E6%A0%BC%E3%80%81%E7%BA%BF%E7%A8%8B%E5%9D%97%E4%B8%8E%E7%BA%BF%E7%A8%8B/" class="md-nav__link">
        线程格、线程块与线程
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Cuda/im2col/" class="md-nav__link">
        im2col
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" type="checkbox" id="__nav_2_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_3">
          深度学习
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="深度学习" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          深度学习
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/BatchNormalization%E5%8E%9F%E7%90%86/" class="md-nav__link">
        BatchNormalization原理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E5%AD%A6%E4%B8%8D%E6%98%8E%E7%99%BD%E7%9A%84%E5%8D%B7%E7%A7%AF%E6%93%8D%E4%BD%9C/" class="md-nav__link">
        学不明白的卷积操作
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4" type="checkbox" id="__nav_2_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_4">
          深度学习编译器
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="深度学习编译器" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          深度学习编译器
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4_1" type="checkbox" id="__nav_2_4_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_4_1">
          Pytorch-Internal
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Pytorch-Internal" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_4_1">
          <span class="md-nav__icon md-icon"></span>
          Pytorch-Internal
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%BC%96%E8%AF%91%E5%99%A8/Pytorch-Internal/%E4%B8%80%E4%B8%AAConv%E7%AE%97%E5%AD%90%E7%9A%84%E7%94%9F%E5%91%BD%E5%8E%86%E7%A8%8B/" class="md-nav__link">
        一个Conv算子的生命历程
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%BC%96%E8%AF%91%E5%99%A8/Pytorch-Internal/Pytorch%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/" class="md-nav__link">
        Pytorch源码阅读
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4_2" type="checkbox" id="__nav_2_4_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_4_2">
          论文研读
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="论文研读" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_4_2">
          <span class="md-nav__icon md-icon"></span>
          论文研读
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%BC%96%E8%AF%91%E5%99%A8/%E8%AE%BA%E6%96%87%E7%A0%94%E8%AF%BB/DLcompiler%E7%BB%BC%E8%BF%B0/" class="md-nav__link">
        DLcompiler综述
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%BC%96%E8%AF%91%E5%99%A8/pyi%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F/" class="md-nav__link">
        pyi文件格式
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5" type="checkbox" id="__nav_2_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2_5">
          微软机器学习系统课本
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="微软机器学习系统课本" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_5">
          <span class="md-nav__icon md-icon"></span>
          微软机器学习系统课本
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5_1" type="checkbox" id="__nav_2_5_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_5_1">
          11-模型压缩与稀疏化
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="11-模型压缩与稀疏化" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_5_1">
          <span class="md-nav__icon md-icon"></span>
          11-模型压缩与稀疏化
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../11-%E6%A8%A1%E5%9E%8B%E5%8E%8B%E7%BC%A9%E4%B8%8E%E7%A8%80%E7%96%8F%E5%8C%96/11.2-%E5%9F%BA%E4%BA%8E%E7%A8%80%E7%96%8F%E5%8C%96%E7%9A%84%E6%A8%A1%E5%9E%8B%E5%8E%8B%E7%BC%A9/" class="md-nav__link">
        11.2-基于稀疏化的模型压缩
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../11-%E6%A8%A1%E5%9E%8B%E5%8E%8B%E7%BC%A9%E4%B8%8E%E7%A8%80%E7%96%8F%E5%8C%96/11.1-%E6%A8%A1%E5%9E%8B%E5%8E%8B%E7%BC%A9%E7%AE%80%E4%BB%8B/" class="md-nav__link">
        11.1-模型压缩简介
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../11-%E6%A8%A1%E5%9E%8B%E5%8E%8B%E7%BC%A9%E4%B8%8E%E7%A8%80%E7%96%8F%E5%8C%96/11.3-%E6%A8%A1%E5%9E%8B%E5%8E%8B%E7%BC%A9%E4%B8%8E%E7%A1%AC%E4%BB%B6%E5%8A%A0%E9%80%9F/" class="md-nav__link">
        11.3-模型压缩与硬件加速
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../11-%E6%A8%A1%E5%9E%8B%E5%8E%8B%E7%BC%A9%E4%B8%8E%E7%A8%80%E7%96%8F%E5%8C%96/11-%E5%89%8D%E8%A8%80/" class="md-nav__link">
        11-前言
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5_2" type="checkbox" id="__nav_2_5_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_5_2">
          5-深度学习框架的编译与优化
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="5-深度学习框架的编译与优化" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_5_2">
          <span class="md-nav__icon md-icon"></span>
          5-深度学习框架的编译与优化
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../5-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%A1%86%E6%9E%B6%E7%9A%84%E7%BC%96%E8%AF%91%E4%B8%8E%E4%BC%98%E5%8C%96/5.1-%E6%B7%B1%E5%BA%A6%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E7%BC%96%E8%AF%91%E5%99%A8/" class="md-nav__link">
        5.1-深度神经网络编译器
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../5-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%A1%86%E6%9E%B6%E7%9A%84%E7%BC%96%E8%AF%91%E4%B8%8E%E4%BC%98%E5%8C%96/5.3-%E5%86%85%E5%AD%98%E4%BC%98%E5%8C%96/" class="md-nav__link">
        5.3-内存优化
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../5-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%A1%86%E6%9E%B6%E7%9A%84%E7%BC%96%E8%AF%91%E4%B8%8E%E4%BC%98%E5%8C%96/5.4-%E5%86%85%E6%A0%B8%E4%BC%98%E5%8C%96/" class="md-nav__link">
        5.4-内核优化
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../5-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%A1%86%E6%9E%B6%E7%9A%84%E7%BC%96%E8%AF%91%E4%B8%8E%E4%BC%98%E5%8C%96/5.5-%E7%AE%97%E5%AD%90%E8%B0%83%E5%BA%A6%E4%BC%98%E5%8C%96/" class="md-nav__link">
        5.5-算子调度优化
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../5-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%A1%86%E6%9E%B6%E7%9A%84%E7%BC%96%E8%AF%91%E4%B8%8E%E4%BC%98%E5%8C%96/5-%E5%89%8D%E8%A8%80/" class="md-nav__link">
        5-前言
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../5-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%A1%86%E6%9E%B6%E7%9A%84%E7%BC%96%E8%AF%91%E4%B8%8E%E4%BC%98%E5%8C%96/5.2-%E8%AE%A1%E7%AE%97%E5%9B%BE%E4%BC%98%E5%8C%96/" class="md-nav__link">
        5.2-计算图优化
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5_3" type="checkbox" id="__nav_2_5_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_5_3">
          6-分布式训练算法与系统
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="6-分布式训练算法与系统" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_5_3">
          <span class="md-nav__icon md-icon"></span>
          6-分布式训练算法与系统
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../6-%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%AD%E7%BB%83%E7%AE%97%E6%B3%95%E4%B8%8E%E7%B3%BB%E7%BB%9F/6.2-%E5%88%86%E5%B8%83%E5%BC%8F%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%9A%84%E6%84%8F%E4%B9%89/" class="md-nav__link">
        6.2-分布式深度学习的意义
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../6-%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%AD%E7%BB%83%E7%AE%97%E6%B3%95%E4%B8%8E%E7%B3%BB%E7%BB%9F/6-%E5%89%8D%E8%A8%80/" class="md-nav__link">
        6-前言
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../6-%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%AD%E7%BB%83%E7%AE%97%E6%B3%95%E4%B8%8E%E7%B3%BB%E7%BB%9F/6.6-%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%AD%E7%BB%83%E7%9A%84%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%B0%83/" class="md-nav__link">
        6.6-分布式训练的通信协调
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../6-%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%AD%E7%BB%83%E7%AE%97%E6%B3%95%E4%B8%8E%E7%B3%BB%E7%BB%9F/6.1-%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%A1%E7%AE%97%E7%AE%80%E4%BB%8B/" class="md-nav__link">
        6.1-分布式计算简介
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../6-%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%AD%E7%BB%83%E7%AE%97%E6%B3%95%E4%B8%8E%E7%B3%BB%E7%BB%9F/6.4-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%B9%B6%E8%A1%8C%E8%AE%AD%E7%BB%83%E5%90%8C%E6%AD%A5%E6%96%B9%E5%BC%8F/" class="md-nav__link">
        6.4-深度学习并行训练同步方式
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../6-%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%AD%E7%BB%83%E7%AE%97%E6%B3%95%E4%B8%8E%E7%B3%BB%E7%BB%9F/6.5-%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%AD%E7%BB%83%E7%B3%BB%E7%BB%9F%E7%AE%80%E4%BB%8B/" class="md-nav__link">
        6.5-分布式训练系统简介
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../6-%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%AD%E7%BB%83%E7%AE%97%E6%B3%95%E4%B8%8E%E7%B3%BB%E7%BB%9F/6.3-%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%AD%E7%BB%83%E7%AE%97%E6%B3%95%E5%88%86%E7%B1%BB/" class="md-nav__link">
        6.3-分布式训练算法分类
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5_4" type="checkbox" id="__nav_2_5_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_5_4">
          1-人工智能系统概述
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="1-人工智能系统概述" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_5_4">
          <span class="md-nav__icon md-icon"></span>
          1-人工智能系统概述
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../1-%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0/1.1-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%9A%84%E5%8E%86%E5%8F%B2%EF%BC%8C%E7%8E%B0%E7%8A%B6%E4%B8%8E%E5%8F%91%E5%B1%95/" class="md-nav__link">
        1.1-深度学习的历史，现状与发展
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../1-%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0/1.3-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%B3%BB%E7%BB%9F%E7%BB%84%E6%88%90%E4%B8%8E%E7%94%9F%E6%80%81/" class="md-nav__link">
        1.3-深度学习系统组成与生态
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../1-%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0/1.2-%E7%AE%97%E6%B3%95%EF%BC%8C%E6%A1%86%E6%9E%B6%EF%BC%8C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E5%8A%9B%E7%9A%84%E8%BF%9B%E6%AD%A5/" class="md-nav__link">
        1.2-算法，框架，体系结构与算力的进步
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../1-%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0/1-%E5%89%8D%E8%A8%80/" class="md-nav__link">
        1-前言
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../1-%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0/1.4-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%A0%B7%E4%BE%8B%E8%83%8C%E5%90%8E%E7%9A%84%E7%B3%BB%E7%BB%9F%E9%97%AE%E9%A2%98/" class="md-nav__link">
        1.4-深度学习样例背后的系统问题
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../1-%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0/1.5-%E5%BD%B1%E5%93%8D%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E7%9A%84%E7%90%86%E8%AE%BA%EF%BC%8C%E5%8E%9F%E5%88%99%E4%B8%8E%E5%81%87%E8%AE%BE/" class="md-nav__link">
        1.5-影响深度学习系统设计的理论，原则与假设
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5_5" type="checkbox" id="__nav_2_5_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_5_5">
          8-深度学习推理系统
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="8-深度学习推理系统" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_5_5">
          <span class="md-nav__icon md-icon"></span>
          8-深度学习推理系统
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../8-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%8E%A8%E7%90%86%E7%B3%BB%E7%BB%9F/8.2-%E6%A8%A1%E5%9E%8B%E6%8E%A8%E7%90%86%E7%9A%84%E7%A6%BB%E7%BA%BF%E4%BC%98%E5%8C%96/" class="md-nav__link">
        8.2-模型推理的离线优化
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../8-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%8E%A8%E7%90%86%E7%B3%BB%E7%BB%9F/8.4-%E6%8E%A8%E7%90%86%E7%B3%BB%E7%BB%9F%E7%9A%84%E8%BF%90%E8%A1%8C%E6%9C%9F%E4%BC%98%E5%8C%96/" class="md-nav__link">
        8.4-推理系统的运行期优化
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../8-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%8E%A8%E7%90%86%E7%B3%BB%E7%BB%9F/8.5-%E5%BC%80%E5%8F%91%E3%80%81%E8%AE%AD%E7%BB%83%E4%B8%8E%E9%83%A8%E7%BD%B2%E7%9A%84%E5%85%A8%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%AE%A1%E7%90%86-MLOps/" class="md-nav__link">
        8.5-开发、训练与部署的全生命周期管理-MLOps
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../8-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%8E%A8%E7%90%86%E7%B3%BB%E7%BB%9F/8.1-%E6%8E%A8%E7%90%86%E7%B3%BB%E7%BB%9F%E7%AE%80%E4%BB%8B/" class="md-nav__link">
        8.1-推理系统简介
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../8-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%8E%A8%E7%90%86%E7%B3%BB%E7%BB%9F/8.3-%E9%83%A8%E7%BD%B2/" class="md-nav__link">
        8.3-部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../8-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%8E%A8%E7%90%86%E7%B3%BB%E7%BB%9F/8-%E5%89%8D%E8%A8%80/" class="md-nav__link">
        8-前言
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5_6" type="checkbox" id="__nav_2_5_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_5_6">
          9-自动化机器学习系统
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="9-自动化机器学习系统" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_5_6">
          <span class="md-nav__icon md-icon"></span>
          9-自动化机器学习系统
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../9-%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%B3%BB%E7%BB%9F/9-%E5%89%8D%E8%A8%80/" class="md-nav__link">
        9-前言
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../9-%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%B3%BB%E7%BB%9F/9.1-%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" class="md-nav__link">
        9.1-自动化机器学习
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../9-%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%B3%BB%E7%BB%9F/9.2-%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%B3%BB%E7%BB%9F%E4%B8%8E%E5%B7%A5%E5%85%B7%E8%AE%BE%E8%AE%A1/" class="md-nav__link">
        9.2-自动化机器学习系统与工具设计
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5_7" type="checkbox" id="__nav_2_5_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_5_7">
          13-人工智能优化计算机系统
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="13-人工智能优化计算机系统" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_5_7">
          <span class="md-nav__icon md-icon"></span>
          13-人工智能优化计算机系统
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../13-%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E4%BC%98%E5%8C%96%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F/13-%E5%89%8D%E8%A8%80/" class="md-nav__link">
        13-前言
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../13-%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E4%BC%98%E5%8C%96%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F/13.3-%E8%90%BD%E5%9C%B0%E6%8C%91%E6%88%98/" class="md-nav__link">
        13.3-落地挑战
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../13-%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E4%BC%98%E5%8C%96%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F/13.1-%E7%AE%80%E4%BB%8B%E4%B8%8E%E8%B6%8B%E5%8A%BF/" class="md-nav__link">
        13.1-简介与趋势
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../13-%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E4%BC%98%E5%8C%96%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F/13.2-%E5%AD%A6%E4%B9%A0%E5%A2%9E%E5%BC%BA%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%BA%94%E7%94%A8/" class="md-nav__link">
        13.2-学习增强系统的应用
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5_8" type="checkbox" id="__nav_2_5_8" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2_5_8">
          7-异构计算集群调度与资源管理系统
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="7-异构计算集群调度与资源管理系统" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_5_8">
          <span class="md-nav__icon md-icon"></span>
          7-异构计算集群调度与资源管理系统
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../7.5-%E5%AD%98%E5%82%A8/" class="md-nav__link">
        7.5-存储
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../7.3-%E8%B0%83%E5%BA%A6/" class="md-nav__link">
        7.3-调度
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          7.4-面向深度学习的集群管理系统
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        7.4-面向深度学习的集群管理系统
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#741" class="md-nav__link">
    7.4.1 深度学习工作负载的需求
  </a>
  
    <nav class="md-nav" aria-label="7.4.1 深度学习工作负载的需求">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    思考题
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#742" class="md-nav__link">
    7.4.2 异构硬件的多样性
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#743" class="md-nav__link">
    7.4.3 深度学习平台的管理与运维需求
  </a>
  
    <nav class="md-nav" aria-label="7.4.3 深度学习平台的管理与运维需求">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    思考与实验设计
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#744" class="md-nav__link">
    7.4.4 深度学习负载与异构硬件下的调度设计
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#745" class="md-nav__link">
    7.4.5 开源和云异构集群管理系统简介
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#746" class="md-nav__link">
    7.4.6 部署异构资源集群管理系统实验
  </a>
  
    <nav class="md-nav" aria-label="7.4.6 部署异构资源集群管理系统实验">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#7461" class="md-nav__link">
    7.4.6.1 实验目的
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7462" class="md-nav__link">
    7.4.6.2 实验环境
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7463" class="md-nav__link">
    7.4.6.3 实验原理
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7464" class="md-nav__link">
    7.4.6.4 实验内容
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7465" class="md-nav__link">
    7.4.6.5 实验报告
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    小结与讨论
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    参考文献
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../7.6-%E5%BC%80%E5%8F%91%E4%B8%8E%E8%BF%90%E7%BB%B4/" class="md-nav__link">
        7.6-开发与运维
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../7.1-%E5%BC%82%E6%9E%84%E8%AE%A1%E7%AE%97%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E7%AE%80%E4%BB%8B/" class="md-nav__link">
        7.1-异构计算集群管理系统简介
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../7-%E5%89%8D%E8%A8%80/" class="md-nav__link">
        7-前言
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../7.2-%E8%AE%AD%E7%BB%83%E4%BD%9C%E4%B8%9A%EF%BC%8C%E9%95%9C%E5%83%8F%E4%B8%8E%E5%AE%B9%E5%99%A8/" class="md-nav__link">
        7.2-训练作业，镜像与容器
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_6" type="checkbox" id="__nav_2_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_6">
          编译原理
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="编译原理" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_6">
          <span class="md-nav__icon md-icon"></span>
          编译原理
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_6_1" type="checkbox" id="__nav_2_6_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_6_1">
          编译器前端
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="编译器前端" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_6_1">
          <span class="md-nav__icon md-icon"></span>
          编译器前端
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/%E7%BC%96%E8%AF%91%E5%99%A8%E5%89%8D%E7%AB%AF/First%E9%9B%86%E4%B8%8EFollow%E9%9B%86/" class="md-nav__link">
        First集与Follow集
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_7" type="checkbox" id="__nav_2_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_7">
          深入理解计算机系统
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="深入理解计算机系统" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_7">
          <span class="md-nav__icon md-icon"></span>
          深入理解计算机系统
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_7_1" type="checkbox" id="__nav_2_7_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_7_1">
          链接与加载
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="链接与加载" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_7_1">
          <span class="md-nav__icon md-icon"></span>
          链接与加载
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F/%E9%93%BE%E6%8E%A5%E4%B8%8E%E5%8A%A0%E8%BD%BD/ELF%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F/" class="md-nav__link">
        ELF文件格式
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_7_2" type="checkbox" id="__nav_2_7_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_7_2">
          操作系统
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="操作系统" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_7_2">
          <span class="md-nav__icon md-icon"></span>
          操作系统
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_7_2_1" type="checkbox" id="__nav_2_7_2_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_7_2_1">
          虚拟化技术
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="虚拟化技术" data-md-level="4">
        <label class="md-nav__title" for="__nav_2_7_2_1">
          <span class="md-nav__icon md-icon"></span>
          虚拟化技术
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E8%99%9A%E6%8B%9F%E5%8C%96%E6%8A%80%E6%9C%AF/%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E5%AE%B9%E5%99%A8%EF%BC%9F/" class="md-nav__link">
        如何理解容器？
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_7_2_2" type="checkbox" id="__nav_2_7_2_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_7_2_2">
          MIT6.828课程
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="MIT6.828课程" data-md-level="4">
        <label class="md-nav__title" for="__nav_2_7_2_2">
          <span class="md-nav__icon md-icon"></span>
          MIT6.828课程
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/MIT6.828%E8%AF%BE%E7%A8%8B/%E7%A5%9E%E5%A5%87%E7%9A%84%E9%93%BE%E6%8E%A5/" class="md-nav__link">
        神奇的链接
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/MIT6.828%E8%AF%BE%E7%A8%8B/lab2%E8%AE%B0%E5%BD%95/" class="md-nav__link">
        lab2记录
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/MIT6.828%E8%AF%BE%E7%A8%8B/%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%98%AF%E5%A6%82%E4%BD%95%E5%90%AF%E5%8A%A8%E7%9A%84%3F/" class="md-nav__link">
        计算机是如何启动的?
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux%E4%B8%AD%E7%9A%84rootfs/" class="md-nav__link">
        Linux中的rootfs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/linux%E7%9A%84%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E6%9C%BA%E5%88%B6/" class="md-nav__link">
        linux的内存分配机制
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_8" type="checkbox" id="__nav_2_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_8">
          C++程序设计
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="C++程序设计" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_8">
          <span class="md-nav__icon md-icon"></span>
          C++程序设计
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_8_1" type="checkbox" id="__nav_2_8_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_8_1">
          深入理解Cmake
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="深入理解Cmake" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_8_1">
          <span class="md-nav__icon md-icon"></span>
          深入理解Cmake
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../C%2B%2B%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Cmake/add_subdirectory%E7%94%A8%E6%B3%95/" class="md-nav__link">
        add_subdirectory用法
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../C%2B%2B%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/%E5%A4%B4%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84%E5%B0%96%E6%8B%AC%E5%8F%B7%E4%B8%8E%E5%BC%95%E5%8F%B7/" class="md-nav__link">
        头文件中的尖括号与引号
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../C%2B%2B%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/Variant%E7%9A%84%E7%94%A8%E6%B3%95/" class="md-nav__link">
        Variant的用法
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_9" type="checkbox" id="__nav_2_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_9">
          应用程序开发
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="应用程序开发" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_9">
          <span class="md-nav__icon md-icon"></span>
          应用程序开发
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_9_1" type="checkbox" id="__nav_2_9_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_9_1">
          Python程序开发
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Python程序开发" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_9_1">
          <span class="md-nav__icon md-icon"></span>
          Python程序开发
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91/Python%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91/PyGame%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/" class="md-nav__link">
        PyGame使用指南
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_10" type="checkbox" id="__nav_2_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_10">
          ACM算法
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="ACM算法" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_10">
          <span class="md-nav__icon md-icon"></span>
          ACM算法
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ACM%E7%AE%97%E6%B3%95/Acwing%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/" class="md-nav__link">
        Acwing学习记录
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#741" class="md-nav__link">
    7.4.1 深度学习工作负载的需求
  </a>
  
    <nav class="md-nav" aria-label="7.4.1 深度学习工作负载的需求">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    思考题
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#742" class="md-nav__link">
    7.4.2 异构硬件的多样性
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#743" class="md-nav__link">
    7.4.3 深度学习平台的管理与运维需求
  </a>
  
    <nav class="md-nav" aria-label="7.4.3 深度学习平台的管理与运维需求">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    思考与实验设计
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#744" class="md-nav__link">
    7.4.4 深度学习负载与异构硬件下的调度设计
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#745" class="md-nav__link">
    7.4.5 开源和云异构集群管理系统简介
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#746" class="md-nav__link">
    7.4.6 部署异构资源集群管理系统实验
  </a>
  
    <nav class="md-nav" aria-label="7.4.6 部署异构资源集群管理系统实验">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#7461" class="md-nav__link">
    7.4.6.1 实验目的
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7462" class="md-nav__link">
    7.4.6.2 实验环境
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7463" class="md-nav__link">
    7.4.6.3 实验原理
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7464" class="md-nav__link">
    7.4.6.4 实验内容
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7465" class="md-nav__link">
    7.4.6.5 实验报告
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    小结与讨论
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    参考文献
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<!--Copyright © Microsoft Corporation. All rights reserved.
  适用于[License](https://github.com/microsoft/AI-System/blob/main/LICENSE)版权许可-->

<h1 id="74">7.4 面向深度学习的集群管理系统<a class="headerlink" href="#74" title="Permanent link">&para;</a></h1>
<p>在之前的章节，我们已经介绍经典的调度算法在深度学习作业的集群调度中的原理和应用。但是这些算法本身没有深入的考虑深度学习作业自身的特点，和更加深入的考虑GPU服务器中GPU的拓扑结构。本章将围绕经典且前沿的针对深度学习负载和GPU服务器特点而设计的平台调度算法进行介绍，期望让读者了解新负载和硬件的特点和调度管理需求，并通过更加适合的方式予以解决，并启发新的工作。本章节的很多工作目前没有严格定论，还属于研究的前沿，本章中更多的是总结当前负载，硬件和平台本身的新问题和设计动机（Motivation），启发读者未来可以思考新的研究和工程工作。</p>
<ul>
<li><a href="#74-面向深度学习的集群管理系统">7.4 面向深度学习的集群管理系统</a></li>
<li><a href="#741-深度学习工作负载的需求">7.4.1 深度学习工作负载的需求</a><ul>
<li><a href="#思考题">思考题</a></li>
</ul>
</li>
<li><a href="#742-异构硬件的多样性">7.4.2 异构硬件的多样性</a></li>
<li><a href="#743-深度学习平台的管理与运维需求">7.4.3 深度学习平台的管理与运维需求</a><ul>
<li><a href="#思考与实验设计">思考与实验设计</a></li>
</ul>
</li>
<li><a href="#744-深度学习负载与异构硬件下的调度设计">7.4.4 深度学习负载与异构硬件下的调度设计</a></li>
<li><a href="#745-开源和云异构集群管理系统简介">7.4.5 开源和云异构集群管理系统简介</a></li>
<li><a href="#746-部署异构资源集群管理系统实验">7.4.6 部署异构资源集群管理系统实验</a><ul>
<li><a href="#7461-实验目的">7.4.6.1 实验目的</a></li>
<li><a href="#7462-实验环境">7.4.6.2 实验环境</a></li>
<li><a href="#7463-实验原理">7.4.6.3 实验原理</a></li>
<li><a href="#7464-实验内容">7.4.6.4 实验内容</a></li>
<li><a href="#7465-实验报告">7.4.6.5 实验报告</a></li>
</ul>
</li>
<li><a href="#小结与讨论">小结与讨论</a></li>
<li><a href="#参考文献">参考文献</a></li>
</ul>
<h2 id="741">7.4.1 深度学习工作负载的需求<a class="headerlink" href="#741" title="Permanent link">&para;</a></h2>
<p>我们使用的集群管理系统管理的大多数作业是深度学习的训练作业。
深度学习作业相比传统的批处理作业，例如大数据作业有一些新的特点和不同。</p>
<ul>
<li>单个深度学习训练作业特点：</li>
<li>训练时间持续数小时甚至几天。</li>
<li>作业主干部分是迭代的计算，每轮迭代可以切分为小时间窗口的任务。这样让作业本身有机会以更小的粒度触发调度，抢占策略。 </li>
<li>在训练过程中不同的时间点做检查点有不同的数据量，这给做检查点提供了优化机会，如果有检查点的支持，可以让平台或框架本身支持更加激进的调度策略，例如，动态迁移作业，装箱作业到同一块GPU，时分复用等。</li>
<li>资源消耗可预测性，可以通过运行时监控获取。由于其可预测性，让调度器有机会可以根据资源消耗做更加优化的作业放置和装箱。</li>
<li>分布式深度学习训练作业特点：</li>
<li>对GPU拓扑结构敏感，例如：数据并行策略通信传递梯度，模型并行策略通信传递中间结果张量，GPU与GPU之间传输带宽容易形成瓶颈。所以考虑GPU亲和性（Affinity）的合并防止策略对降低分布式训练作业的完工时间有帮助。但会引发新的问题，由于调度是一批GPU，容易造成亲和性约束不满足，产生资源碎片。</li>
<li>批量深度学习训练作业特点：自动化机器学习场景下，用户会一次性提交大量的深度学习作业。自动机器学习训练作业的一个关键特征是反馈驱动探索。由于深度学习实验固有的反复试验方法，用户通常会尝试多个作业配置（多项工作），并使用这些工作的早期反馈来决定是否优先考虑或杀死其中的某些子集。这种有条件的探索，称为超参数搜索，可以是手动的，也可以是系统自动触发。所以我们经常可以看到集群中有大量类似作业和被提前终止的作业。  </li>
</ul>
<p>根据深度学习作业特点和软件栈和硬件栈的底层机制支持，可以框架或平台可以协同设计启发的优化策略，提升资源利用率等指标。</p>
<h4 id="_1">思考题<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h4>
<p>总结思考深度学习作业和传统操作系统作业以及大数据平台作业的异同点？</p>
<h2 id="742">7.4.2 异构硬件的多样性<a class="headerlink" href="#742" title="Permanent link">&para;</a></h2>
<p>深度学习作业使用的服务器一般会挂载多块GPU，而且训练时主要的计算单元是GPU。相比传统的大数据作业和服务器硬件有一些新的特点和不同。多GPU集群运行深度学习问题与挑战：由于多块GPU之间的互联方式多样，造成作业的不同放置方式受到GPU拓扑结构影响，进而影响总线容易产生争用，影响性能。GPU根据一定拓扑挂载在PCIe总线或交换机上，GPU与GPU之间通信可能节点内跨越PCIe，PCIe交换机，节点之间可能跨越InfiniBand或以太网。“距离”最近的GPU之间通信代价越低。拓扑结构与部署会影响多卡与分布式作业的训练性能。同时，作业本身由于可能共享服务器，数据总线等资源也受到服务器上同时运行作业的干扰。</p>
<p>所以针对硬件特点可以设计启发优化策略：考虑集群和服务器节点的GPU拓扑结构的亲和性(Affinity)调度。这点和传统NUMA架构中考虑<a href="https://en.wikipedia.org/wiki/Processor_affinity">处理器亲和性(Processor Affinity)</a>的问题与优化有异曲同工之处。我们可以看到，对系统问题，我们可以从传统的操作系统的经典设计中找到设计原则，对新工作形成指导和借鉴。</p>
<h2 id="743">7.4.3 深度学习平台的管理与运维需求<a class="headerlink" href="#743" title="Permanent link">&para;</a></h2>
<p>深度学习平台对上管理深度学习模型训练负载，对下管理以GPU，InfiniBand为代表的异构硬件，平台管理与运维遇到了相比之前大数据平台等平台新挑战。</p>
<p>平台管理者相比数据科学家等使用平台的用户，相比单纯考虑作业执行速度等性能指标，更加关注以下更加全面的设计目标：</p>
<ul>
<li>效率</li>
<li>GPU集群价格昂贵，更新换代频繁，如何规划好集群，提升投入产出比，如何在现有集群中，减少资源碎片，提升利用率也有很大的挑战。调度算法在一定程度上能优化和提升集群的资源利用率。</li>
<li>公平性</li>
<li>目前使用深度学习平台的用户既有工程目的也有很多是科研目的。在训练生产模型的同时，也有一些是研究投稿赶论文截止的需求，造成相比传统批处理调度场景，用户有了类似特定时段的峰值资源使用需求。平台需要保证各组资源使用的公平性，同时提前规划好用户的资源使用同时兼顾峰值利用需求，需要管理员设计好相应的策略。</li>
<li>稳定性</li>
<li>由于深度学习框架的设计者在初始没有像大数据社区一样把容错当成第一要义，框架提供的容错机制过于简单，同时没有自动备份与恢复的支持，造成在之后的设计版本中才有弹性等功能的支持。这样对底层平台来说造成比较大的运维负担。</li>
<li>由于节点上的异构硬件也有一定概率产生硬件问题（例如，<a href="https://ieeexplore.ieee.org/abstract/document/7056044">GPU故障(Failure)</a>），造成平台稳定性另一方面的挑战。如何高效，敏捷的发现和修复故障，是平台方需要不断沉淀的，这需要系统化的系统设计，开发流程设计与管理策略设计共同作用。</li>
<li>可维护性</li>
<li>平台团队同时在开发和运维平台，可维护性也是平时减少运维负担的一个重要考虑的因素。通过微服务等手段(回顾操作系统<a href="https://en.wikipedia.org/wiki/Microkernel">微内核</a>的设计思想)将功能模块尽可能的拆分，能够让故障的定位与修复最小化，同时良好的DevOps流程搭建，敏捷的开发与项目管理也为平台的可维护性提升起到关键的作用。</li>
<li>用户体验</li>
<li>用户体验良好并统一的作业提交，作业管理与调试工具，能大幅提升用户的开发生产力，同时也能减轻平台运维工程师的负担。</li>
</ul>
<p>除了以上指标，平台也会关注性能（吞吐，完工时间等）指标。综上所述我们看到，平台本身模块众多，涉及的外部交互的软硬件多样，使用和维护的用户也很多，所以其面对的问题场景较为复杂，作为平台设计者和使用者需要通盘考量，性能只其中一个环节，我们还要以系统化的视角去设计和管理整个异构资源，为上层应用负载与用户提供更加透明与便捷的用户体验。</p>
<h3 id="_2">思考与实验设计<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p>思考，如果需要兼顾以上指标，新一代深度学习调度与平台设计应该朝着哪个方向设计与发展？</p>
<p>请读者设计算法或策略，保证公平性的同时，最大限度提升集群效率，可以上一小节的痕迹（Trace）进行实验设计与算法验证。</p>
<h2 id="744">7.4.4 深度学习负载与异构硬件下的调度设计<a class="headerlink" href="#744" title="Permanent link">&para;</a></h2>
<p>接下来，我们将介绍不同侧重点，考虑不同设计目标的调度器设计，这些调度器由于设计目标不同，基于能获取信息的 <strong><em>假设</em></strong> 也不同，同时实现和对作业的入侵性也不同，读者在选用和设计调度器时，需要考虑不同算法的优劣势根据需求酌情选择。</p>
<ul>
<li><strong><em>利用领域知识(深度学习作业特点)和运行时数据驱动，降低作业延迟和提升效率的框架与平台协同设计的调度器设计</em></strong></li>
</ul>
<p><a href="https://dl.acm.org/doi/10.5555/3291168.3291212">Gandiva</a>根据深度学习作业特点（早反馈，分布式作业对拓扑敏感等），以及硬件和操作系统对GPU计算的进程上下文切换的不足进行弥补，通过框架和平台协同设计进而提升整体集群资源利用率，所以其假设是框架提供支持基本检查点和迁移的功能原语。</p>
<p>Gandiva设计了两种模式：</p>
<p>一种是 <strong><em>反应模式(Reactive Mode)</em></strong> ：</p>
<p>类似传统调度器事件驱动的设计，根据不同事件和状态（作业到达(Arrivals), 离开(Departures), 失效(Failures)）触发调度策略，我们可以抽象理解其为一个状态机（State Machine）。</p>
<p><center> <img src="./img/4/affinity.png" ch="500" width="700" height="160" /></center>
<center>图7-4-1. 分布式作业调度受局部性影响 (<a href="https://www.usenix.org/sites/default/files/conference/protected-files/osdi20_slides_zhao.pdf">图片引用</a>)</center></p>
<p>通过图中可以看到，将同样需要2块GPU卡的作业分别调度在，相同PCIe交换机(Switch)，跨交换机和跨节点下进行部署运行，会产生40%~5x的降速。所以对于多卡作业，考虑部署的局部性，通过亲和性调度，可以让作业执行更快，让出更多的资源执行其他作业，进而对整体完工时间受益，进而提升资源利用率。</p>
<p>当触发调度时，其使用考虑亲和性(Affinity)的调度策略：
在调度过程中按以下优先级考虑和排序节点进行作业分配，这样能够更多的考虑GPU的亲和性和拓扑结构，让深度学习作业减少数据I/O的瓶颈，提升性能。
其优先考虑的节点优先级为。
1. 拥有相同亲和性的节点。
2. 还未标注亲和性的节点。
3. 有不同亲和性的节点。
4. 进行超额订阅(Oversubscription)，在有相同亲和性的节点暂停和恢复其他作业。
5. 不满足之前条件，则作业排队等待。</p>
<p>例如，如图7-4-2所示，调度器将需要1个GPU的作业放在一起，但需要2或4个GPU的作业放置在不同的服务器上。 此外，我们可以通过选择负载最小的服务器，试图平衡每台服务器上的超额订阅（Over-Suscription）负载（例如，图中防止1个GPU需求作业的服务器中，各有6个1个GPU需求的作业）。</p>
<p><center> <img src="./img/4/7-4-6-gandivaplacement.png" ch="500" width="700" height="400" /></center>
<center>图7-4-2. 16块GPU集群中，Gandiva调度实例 (<a href="https://www.usenix.org/system/files/osdi18-xiao.pdf">图片引用</a>)</center></p>
<p>另一种是 <strong><em>内省模式(Introspective Mode) </em></strong>：</p>
<p>在作业执行后，持续监控并定期优化当前作业的放置 (Placement)，同时通过扩展框架支持细粒度的检查点和恢复功能，对后续策略提供基础原语的支持。通过不断监控作业利用率和节点资源利用率，不断进行作业的，装箱(Bin Packing)，迁移(Migration)，增长收缩(Grow-Shrink)，超额定于和时间切片(Time Slicing)，进而提升整体资源利用率，降低作业的完工时间(Makespan)。
这些底层机制有以下好处：
- 装箱 (Bin Packing)：在保证GPU显存约束的情况下，根据浮点运算量，将更多的作业装箱到相同GPU，提升资源利用率。
- 时分复用(Time Slicing):利用框架层或底层实现的检查点和恢复机制，多个作业可以通过时分复用，共享单块GPU。
- 迁移 (Migration)：利用框架层或底层实现的检查点和恢复机制，当有空闲资源或奖励资源，动态迁移作业使用免费资源，加速训练，当被抢占迁移作业保证作业之前训练不失效。</p>
<p>图7-4-3 展示了集群实验的一个示例。当多作业调度执行的场景，其中有4个均需要2块GPU的作业，这些作业都已经被调度，但是其中3个作业都没有好的亲和性（J1，J2和J3），只有J0的GPU被打包分配到了相同的节点。
3分钟后，一个使用DeepSpeed框架训练的作业（图中绿色圆圈表示）训练完成并释放8块GPU，其中3块在图中以绿色圆圈表示，并分布在不同服务器，这三块GPU有潜力提升当前多个作业的训练效率。Gandiva调度器因此启动了迁移流程，重新分配J1，J2和J3到放置在一起的GPU。为了减少碎片，我们选择迁移空闲GPU最多的服务器上的作业进行迁移。之后开始迁移运行的作业从当前服务器（空闲GPU更多的）到另一个服务器（空闲GPU更少的），进而同作业的任务可以执行在相同服务器的GPU。Gandiva不断重复这个过程，直到非空闲服务器上的空闲GPU数量小于一定阈值（实验中使用&frac34;作为阈值），或者直到没有作业能够受益于作业迁移。</p>
<p><center> <img src="./img/4/7-4-7-jobmitivationgandiva.png" ch="500" width="700" height="300" /></center>
<center>图7-4-3. 共享资源集群中，Gandiva进行作业迁移实例 (<a href="https://www.usenix.org/system/files/osdi18-xiao.pdf">图片引用</a>)</center></p>
<p>Gandiva的设计方法能大幅度降低作业执行延迟和提升资源利用率，但需要结合其他策略才能兼顾公平性等目标，同时需要框架和平台提供功能支持。同时也存在很多其他挑战，例如：需要能够遥测深度学习作业负载信息，同时越来越多样的资源使用状况的深度学习负载来说挑战较大。</p>
<p>Gandiva本身需要框架或硬件提供检查点（Checkpoint）和实时迁移 (Live Migrtation)的支持，这点假设对现有平台挑战较大，同时需要框架和平台协同设计，对一些公司或平台两者为分离团队维护挑战较大。</p>
<p>同时拥有基于在线运行时性能信息反馈和框架-平台协同设计的调度器工作还有：
- 基于在线(Online)作业信息反馈，进行调度算法优化设计的调度器<a href="https://dl.acm.org/doi/10.1145/3190508.3190517">Optimus</a>等。
- 需要框架和平台协同设计提供支持的调度器还有<a href="https://dl.acm.org/doi/abs/10.5555/3488766.3488796">AntMan</a>等。</p>
<p>但是请读者思考，当前这类调度器本质依赖框架协同，本质属于框架与平台的协同设计（Co-Design）的产物，在很多假设或者条件不能满足的情况下，很难实现或部署。例如，当前框架多样，如果平台本身难以限定用户使用唯一的框架进行模型训练，以上的功能也就难以完全落地与应用。</p>
<p><strong><em>经典回顾</em></strong></p>
<p>同时我们也可以看到数据驱动(Data-Driven)的设计思路和检查点与迁移等经典机制再次在新的场景下的应用与创新，数据驱动的内省模式是经典的系统优化策略，和JIT（Just-In-Time）优化利用运行时信息进行优化有异曲同工之妙，同时检查点和实时迁移是操作系统中进程，线程上下文切换的经典设计，其在提升资源复用的设计目标上是基础机制。</p>
<p><a href="https://en.wikipedia.org/wiki/Processor_affinity">处理器亲和性（Processor affinity）</a>：处理器亲和性可以将进程或线程绑定和解除绑定到中央处理单元 (CPU) 或一系列 CPU。传统的处理器亲和性更多是缓存亲和性减少缓存失效，上面介绍的工作中更多的是通过亲和性减少通信I/O，这点更像NUMA中考虑的亲和性问题，也像之前介绍的数据读写的局部性（Locality）原则所要解决的问题，减少数据跨节点搬运。</p>
<p><a href="https://en.wikipedia.org/wiki/Preemption_(computing)#Time_slice">时间片（Time Slice）</a>：调度中断以允许操作系统内核在它们的时间片到期时在进程之间切换，从而有效地允许处理器的时间在多个任务之间共享，给人一种它正在并行（同时）处理这些任务的错觉。控制这种设计的操作系统称为多任务系统。所以在上面的工作实现中需要模拟操作系统的中断机制，通过信号控制进程。</p>
<p><a href="https://en.wikipedia.org/wiki/Process_migration">进程迁移（Process Migration）</a>：在计算中，进程迁移是一种特殊的操作系统进程管理形式，通过这种形式，进程从一个计算环境移动到另一个计算环境。其源于分布式计算，但现在使用更广泛。在多核机器（一个处理器或多个处理器上的多核）上，进程迁移作为进程调度的标准部分发生，并且在给定机器内迁移进程非常容易，因为大多数资源（内存、文件、套接字）并不需要改变的只需要执行上下文（主要是程序计数器和寄存器）切换。所以在上面的工作实现中需要模拟操作系统的上下文切换，通过迁移进程“上下文”，进而在其他节点恢复进程。</p>
<ul>
<li><strong><em>基于经典集群调度器并根据新负载特点（例如，GPU亲和性）进行策略扩展的调度器设计</em></strong></li>
</ul>
<p>深度学习系统社区有很多有大数据系统和平台背景的工程师，同时深度学习训练负载从作业性质上可以归纳为<a href="https://research.google/pubs/pub43438/">批处理作业(Batch Job)</a>，那么以往成熟的大数据批处理作业集群管理系统<a href="https://hadoop.apache.org/docs/stable/hadoop-yarn/hadoop-yarn-site/YARN.html">YARN</a>中的调度器，无疑在平台设计初期是一个较好的入手点和起点，因为起经过大规模的生产环境检验，提供容量调度，虚拟集群等机制的支持，社区活跃，应用范围广。所以有些工作(<a href="https://dl.acm.org/doi/10.5555/3358807.3358888">YARN-CS</a>)和开源系统<a href="https://github.com/microsoft/pai">OpenPAI</a>的初期采用从经典调度器的基础上进行扩展深度学习负载调度特点功能支持的思路进行设计。<a href="https://dl.acm.org/doi/10.5555/3358807.3358888">YARN-CS</a>研究作业在不同GPU拓扑下的性能影响，进而通过分析作业调度日志，证明分布式作业尽可能考虑局部性(Locality)的调度到“离得近”且通信代价小的一批GPU节点上，能够降低作业的完工时间。同时其还通过观察和实验发现，过于追求严格的局部性，会造成较长的排队延迟（Queuing Delay），其称谓碎片延迟（Fragmentation Delay），适当放松局部性约束是有意义的，随着时间的推移，局部性以减轻分布式作业的排队延迟。 总结起来，除了由于容量调度产生的为公平性共享（Fare-Share）产生的排队延迟（这种延迟一定程度可以通过抢占式调度降低），机器学习任务的群调度和局部性需求会产生碎片延迟（Fragmentation Delay）。这个洞察也启发之后会介绍的HiveD的延续性工作。</p>
<ul>
<li><strong><em>考虑历史作业执行时间（历史数据驱动）和亲和性合并放置，降低完工时间和提升资源利用率的调度器设计</em></strong></li>
</ul>
<p>调度器<a href="https://dl.acm.org/doi/10.5555/3323234.3323274">Tiresias</a>中对集群历史作业的资源分配和完工时间日志痕迹(Log Trace)进行统计分析，通过数据驱动的设计思路，预估作业执行时间，并利用这些信息指导调度，优先调度短时作业，降低作业的完工时间。并借鉴经典的基廷斯系数(<a href="https://en.wikipedia.org/wiki/Gittins_index">Gittins index</a>)等理论进行优化问题的抽象与策略设计，优先调度大量短作业，提升整体完工时间。另外同时对分布式深度学习作业进行基准测试，启发对亲和性敏感的负载进行考虑合并防止策略，提升利用率，同时也抛出亲和性影响排队时间的伏笔，为后续HivdD等的研究工作铺垫新的挑战问题。同时其在论文中也提供了表7-4-1中调度器的比较。相比于基于 Apache YARN 的容量调度程序（YARN-CS）和 Gandiva，Tiresias 旨在最小化平均 JCT。与 Optimus 不同，Tiresias 可以有效地安排工作利用或不利用部分先验知识（表7-4-1）。 此外，Tiresias 可以根据Tiresias 分析器自动捕获的结构，智能放置分布式深度学习作业。</p>
<style>table{margin: auto;}</style>
<table>
<thead>
<tr>
<th></th>
<th>YARN-CS</th>
<th>Gandiva</th>
<th>Optimus</th>
<th>Tiresias（Gittins index）</th>
<th>Tiresias（LAS）</th>
</tr>
</thead>
<tbody>
<tr>
<td>先验知识（Prior Knowledge）</td>
<td>None</td>
<td>None</td>
<td>完工时间（JCT）预测</td>
<td>完工时间（JCT）分布</td>
<td>None</td>
</tr>
<tr>
<td>调度算法（Scheduling Algorithm）</td>
<td>先进先出（FIFO）</td>
<td>分时（Time-sharing）</td>
<td>剩余时间驱动（Remaining-time-driven）</td>
<td>吉廷斯指数（Gittins index）</td>
<td>最少获得服务（LAS）</td>
</tr>
<tr>
<td>调度输入（Scheduling Input）</td>
<td>到达时间（Arrival time）</td>
<td>N/A</td>
<td>剩余时间（Remaining Time）</td>
<td>获得服务（Attained service），例如空间和时间维度</td>
<td>获得服务（Attained service）</td>
</tr>
<tr>
<td>调度维度（Schedule Dimensions）</td>
<td>时间的（Temporal），执行多久</td>
<td>None</td>
<td>时间的（Temporal）</td>
<td>空间的（Spatial） &amp; 时间的（temporal）</td>
<td>空间的（Spatial），需要多少GPU &amp; 时间的（temporal）</td>
</tr>
<tr>
<td>调度优先级（Job Priority）</td>
<td>连续的（Continuous）</td>
<td>连续的（Continuous）</td>
<td>连续的（Continuous）</td>
<td>离散队列（Discretized queues）</td>
<td>离散队列（Discretized queues）</td>
</tr>
<tr>
<td>作业强占（Job Preemption）</td>
<td>N/A</td>
<td>上下文切换（Context switch）</td>
<td>模型检查点（Model checkpoint）</td>
<td>模型检查点（Model checkpoint）</td>
<td>模型检查点（Model checkpoint）</td>
</tr>
<tr>
<td>最小化平均作业完工时间（Minimizing Average JCT）</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>饥饿避免（Starvation Avoidance）</td>
<td>N/A</td>
<td>N/A</td>
<td>动态资源（Dynamic resource）</td>
<td>如达到饥饿阈值，提升到最高优先级Q1</td>
<td>如达到饥饿阈值，提升到最高优先级Q1</td>
</tr>
<tr>
<td>作业放置（Job Placement）</td>
<td>合并（Consolidation）</td>
<td>试错（Trial-and-error）</td>
<td>基于容量（ Capacity-based）</td>
<td>基于观测的（Profile-based）</td>
<td>基于观测的（Profile-based）</td>
</tr>
</tbody>
</table>
<p><center>表7-4-1. Tiresias对深度学习调度器比较总结 (<a href="https://www.usenix.org/system/files/nsdi19-gu.pdf">表格引用</a>)</center></p>
<p>当前此类工作在实施过程中假设集群已经积累了大量的历史作业，且历史作业模式较为稳定（如果变化较快需要持续更新）。其工作负载驱动的调度思想相比Gandiva运行时监控测试运行来说，在作业调度之前为调度器获取了更多信息，进而可以求解信息更全的优化问题。</p>
<ul>
<li><strong><em>多租环境下，降低由于亲和性调度造成排队延迟问题和资源分配碎片问题的调度器设计</em></strong></li>
</ul>
<p><center> <img src="./img/4/queuedelay.png" ch="500" width="600" height="200" /></center>
<center>图7-4-4. 排队延迟问题 (<a href="https://www.usenix.org/sites/default/files/conference/protected-files/osdi20_slides_zhao.pdf">图片引用</a>)</center></p>
<p>如图所示，图7-4-4展示2个月的日志数据，2232个GPU的集群，11个租户的情况下的私有(Private)，共享多租(Shared）和HiveD优化后的情况下，作业的排队时间延迟问题，其中红色的线中我们观察到，平均有7倍的延迟由于多租环境下考虑要求作业满足节点亲和性硬约束（尽可能将作业调度到通信距离更近的节点）造成作业延迟调度。</p>
<p><a href="https://dl.acm.org/doi/10.5555/3488766.3488795">HiveD</a>提出如果假设调度深度学习作业同时考虑多租环境，不同租户（Tenants）之间会配置不同的资源配额，以配额被分配相应的资源，但是如果考虑GPU亲和性的调度策略，会尽可能将亲和性高的资源整体分配给作业，这就会造成集群调度容易出现排队延迟较高的异常。HiveD通过设计多级单元格（Cell）结构，设计了伙伴单元格分配(Buddy Cell Allocation)算法去保证在之前的约束下，资源能够高效分配，降低排队时间和资源碎片。同时HiveD能够和现有的调度器进行较好的集成。</p>
<p>HiveD本身的兼容性较好，能够与其他调度器兼容的集成使用。图7-4-4 展示了一个示例，其中有 4 个级别的单元格结构（Cell Structure）：GPU (Level-1)、PCIe 交换机（Switch）(Level-2)、CPU 套接字（Socket）（Level-3）和节点级别（Level-4）。当前实例集群有一个机架，由四个 8-GPU 节点组成，由三个租户 A、B和 C共享。每个租户的单元格资源分配和租户的虚拟集群（VC）情况总结在图 3 的表格中。租户 A和 B 的 VC 都保留了一个 3 级（Level）单元格（4 个 GPU 在同一个CPU插槽），一个2级单元格（2个GPU在同一个PCIe 交换机）和一个 1 级单元格（单个 GPU）。租户 C 是一个更大的租户，它保留了两个 4 级单元格（节点级别）和一个 2 级单元格。给定图7-4-3 中定义的 VC 视图，HiveD 可以采用第三方调度器（例如，7.3和7.4中介绍的调度器）来在当前租户分配的资源视图下继续进行租户内的作业资源调度。从第三方调度器的角度来看，VC视图和私有集群没有区别，由不同大小的节点组成（即不同级别单元格）。例如，调度程序可以将租户 C 视为具有两个 8-GPU 节点和一个 2-GPU 节点的私有集群，尽管 2-GPU 节点实际上是一个 2 级单元。请注意，第三方调度程序可以使用任何 GPU 分配的单元格。例如，它可以调度两个 2-GPU 作业到一个 4-GPU (level-3) 单元：一个单元格是资源的粒度在 VC 和物理集群中保留，但不是必须的第三方调度器的进行作业调度的粒度。</p>
<p>在单元层次结构中，第 k 级单元 c 由一个 S 集合其中包含一组第 k-1 级单元格构成。S中的单元格称为伙伴单元格（Buddy Cells）。伙伴单元格可以合并到更高级别的单元格中（例如第k级）。我们假设单元格展示了分层统一的可组合性：(1) 在满足租户方面，所有 k 级单元都是等效的，请求第 k 级单元，并且 (2) 所有第 k 级单元可以被拆分到相同数量的第k - 1 级单元格。
<center> <img src="./img/4/7-4-5-hivedmotivatingexample.png" ch="500" width="700" height="800" /></center>
<center>图7-4-5. HiveD机架的多级单元分配示例。 (<a href="https://www.usenix.org/system/files/osdi20-zhao_hanyu.pdf">图片引用</a>)</center></p>
<p>由于篇幅所限，我们暂不列出调度算法细节，而主要介绍其相比其他算法的较大不同点，动机，和方法设计和启发实例，读者如果对HiveD的调度算法策略感兴趣，可以参考其<a href="https://github.com/microsoft/hivedscheduler">HiveD论文</a>。</p>
<p>HiveD假设平台已经提供多租虚拟集群机制，以及能在平台获取到GPU拓扑，同时多卡分布式作业多，有需求考虑作业的GPU亲和性问题。</p>
<p>读者可以参考其文献<a href="https://dl.acm.org/doi/10.5555/3488766.3488795">HiveD</a>，或使用和测试其已<a href="https://github.com/microsoft/hivedscheduler">开源的HiveD调度器</a>。</p>
<p><strong><em>经典系统设计回顾</em></strong></p>
<p>同时我们也可以看到经典的系统算法再次在新的场景下的应用与创新，伙伴系统是资源分配算法中常常使用的机制用于减少碎片的发生，常常用于内存分配器或资源调度器中。例如，经典的<a href="https://en.wikipedia.org/wiki/Buddy_memory_allocation">Buddy memory allocation</a>，伙伴内存分配技术是一种内存分配算法，它将内存划分为多个分区，以尽可能地满足内存请求。该系统利用将内存不断分成两半来尝试提供最佳匹配的块尺寸，同时内存回收时有利于相邻内存块合并。根据Wikipedia，Donald Knuth 的说法，伙伴系统由 Harry Markowitz 于 1963 年发明，并由 Kenneth C. Knowlton 首次描述（1965 年出版）。伙伴系统优势是，易于实现，很容易合并相邻的孔（Holes）减少外碎片（External Fragmentation），快速分配内存和释放内存。劣势是，它要求所有的分配单元都是 2 的幂，容易导致内部碎片化（Internal Fragmentation）。</p>
<p><strong><em>知识点总结与展望</em></strong></p>
<p>通过以上调度经典算法的脉络，我们可以看到，在深度学习集群调度问题中充满了不同的设计目标的权衡和需要满足的约束，之前我们已经总结过调度算法的设计目标，接下来我们可以总结调度问题设计过程中常常可以追加和需要满足的硬约束(Hard constraint)和软约束(Soft constraint)。</p>
<ul>
<li>配额(Quota)约束：虚拟集群等多租环境有严格的配额约束保证公平性。保证作业的GPU，GPU内存，CPU，主存等资源需要有空闲资源保证能分配给作业使用。此类约束一般可以设计为硬约束(Hard Constraint)，需要必须满足。但是可以通过抢占等底层机制的支持，适当放松。</li>
<li>最小资源保证约束：容量调度等场景有虚拟集群的最小资源佩配额约束保证公平性。此类约束一般可以设计为硬约束(Hard Constraint)，需要必须满足。</li>
<li>资源局部性(Locality)：GPU亲和性约束有助于降低分布式或多卡训练作业的通信开销，降低完工时间。此类约束一般可以设计为软约束(Soft Constraint)，不需要必须满足。</li>
<li>完工时间约束：例如，保证排队时间低于一定条件，对排队较久或执行时间更短的作业优先调度。此类约束一般可以认为是软约束(Soft Constraint)。</li>
</ul>
<p>随着新技术的发展，还会有新的调度算法设计和产生，最新的深度学习集群调度算法研究工作，读者可以关注OSDI，SOSP，ATC，NSDI，SoCC等会议的最新进展。</p>
<p>总结起来，调度器的算法求解的是基于不同的可获取（例如，在线，离线获取）的作业（时间）和硬件（拓扑）上下文信息假设，针对优化目标（例如，完工时间，平均完工时间等），满足特定的约束（例如，局部性）的作业资源分配的多约束优化问题。在历史的长河中，涌现出非常多的经典算法设计，同时针对深度学习平台，还会不断涌现新的算法设计，感兴趣的读者可以思考，应用和研究相关工作，为未来平台管理打下坚实基础。</p>
<h2 id="745">7.4.5 开源和云异构集群管理系统简介<a class="headerlink" href="#745" title="Permanent link">&para;</a></h2>
<p>本小节我们将介绍代表性的开源和企业内部的大规模异构集群管理系统。基于开源系统，企业可以部署和构建自己的平台，提升资源管理能力，资源利用率和开发效率。基于内部大规模异构集群管理系统所发布的参考文献，企业可以较早的规划和采取最佳实践策略，将未来可预见的问题较早规避，并持续扩容。</p>
<ul>
<li>开源人工智能平台-<a href="https://github.com/microsoft/pai">OpenPAI</a></li>
</ul>
<p><center> <img src="./img/4/pai.png" ch="500" width="500" height="600" /></center>
<center>图7-4-6. OpenPAI架构图 (<a href="https://github.com/microsoft/pai">图片引用</a>)</center></p>
<p>OpenPAI是由微软亚洲研究院系统组和微软（亚洲）互联网工程院联合研发的，支持多种深度学习、机器学习及大数据任务，可提供大规模GPU集群调度、集群监控、任务监控、分布式存储等功能，且用户界面友好，易于操作。OpenPAI正在转向更健壮、更强大和更轻量级的架构。OpenPAI 也变得越来越模块化，以便平台可以轻松定制和扩展以满足新的需求。OpenPAI 还提供了许多 AI 用户友好的功能，使最终用户和管理员更容易完成日常的人工智能作业。OpenPAI通过统一的框架控制器(Framework Controller)，类似YARN一样提供统一的AppMaster，提供对各个深度学习或大数据框架的自动部署，监控，重试(Retry)的支持。同时提供丰富的运行时信息监控，服务状态监控，调试(远程SSH)等功能支持，功能和组件较为丰富。同时还提供应用市场，插件化支持和扩展平台上可以运行的应用。</p>
<ul>
<li>基于Kubernetes社区原生开源平台-<a href="https://www.kubeflow.org/">Kubeflow</a></li>
</ul>
<p>Kubeflow是由Google开源的平台项目，该项目致力于使机器学习工作流在 Kubernetes上的部署变得简单、便携和可扩展。由于Kubeflow是Kubernetes社区原生支持，一经推出，社区发展就非常迅速，扩展组件（例如，调度，工作流管理与可视化等）发展迅速。Kubeflow的设计目标不是重新创建其他服务，而是提供一种直接的方法，将用于机器学习和深度学习的同类最佳开源系统部署到不同的基础设施。无论用户在何处运行Kubernetes，都可以运行Kubeflow。 Kubeflow通过定制化各个框架的Operator，提供对各个深度学习或大数据框架的自动部署，监控，重试(Retry)的支持，但是区别是，没有像YARN一样提供统一的AppMaster，需要各个框架依赖社区构建，为之后的维护和功能支持会增加额外负担。</p>
<ul>
<li>企业内面向第一方(First-party)平台-<a href="https://dl.acm.org/doi/10.5555/3358807.3358888">Philly</a></li>
</ul>
<p>Philly 是微软内部使用的大规模AI训练平台，Philly 旨在支持执行有监督式机器学习的训练工作负载。这包括培训来自开发产品的生产团队的工作，这些产品使用用于图像分类、语音识别等的模型。有相关研究工作对Philly上的<a href="https://dl.acm.org/doi/10.5555/3358807.3358888">资源分配，深度学习作业性能特点</a>和<a href="https://dl.acm.org/doi/10.1145/3377811.3380362">深度学习程序缺陷</a>进行研究，从中我们可以观察和了解大规模生产环境中作业资源争用，资源利用率，调度策略设计和程序缺陷等问题及启发相关新的研究工作。  </p>
<ul>
<li>公有云面向第三方(Third-party)人工智能平台服务-<a href="https://arxiv.org/abs/2202.07848">Singularity</a></li>
</ul>
<p>Singularity是微软Azure提供的大规模云端AI训练平台服务，Singularity旨在支持调度并执行跨数据中心，抢占式和弹性调度的深度学习作业。Singularity的核心是一种工作负载感知的调度程序，它可以透明地抢占和弹性扩展深度学习工作负载，以在不影响其正确性或性能的情况下在全球范围内的AI加速器（例如 GPU、FPGA）中提高利用率。默认情况下，Singularity 中的所有作业都是可抢占、可迁移和动态调整大小（弹性）。作业可以动态且透明地 (a) 抢占并迁移到一组不同的节点、集群、数据中心或区域，并准确地从执行被抢占的点，以及 (b) 在给定类型的一组不同的加速器上调整大小（即弹性地放大/缩小）。Singlularity通过底层实现设备代理(Device Proxy)机制，通过在驱动层实现透明的检查点（checkpointing）功能支持，进而支持作业的抢占，迁移与弹性调整。从这里我们可以看到很多高层应用的功能十分依赖底层基础机制的支持。相较于Gandiva对GPU备份在框架层设计检查点，Singularity在内核驱动层面设计检查点，可以做到透明模型检查点和弹性作业的支持，但是难以获取上层语义，可能潜在产生冗余备份。</p>
<p>同性质的公有云代表性人工智能平台还有，亚马逊AWS SageMaker，阿里云PAI，等。</p>
<p>在工业界，有大规模人工智能应用场景的公司，都需要购买并部署大规模异构资源管理平台，并进行定制化的功能开发与支持，感兴趣的读者可以关注开源和业界的公开分享，并不断设计和重构公司的平台系统，让平台更加稳定与高效。</p>
<p>面向深度学习的集群管理系统目前仍是学术界和工业界的前沿和重要的研究和工程实践的方向，仍在不断发展和迭代，以上内容很多经典问题场景已经有很多共识，但仍有很多问题各家机构呈现出不同的方案，解决方法和新的问题仍在高速发展，请感兴趣的读者或者从业者密切关注社区的发展与前沿，一起推动人工智能领域的集群资源管理不断朝着更加成熟，稳定与高效发展。</p>
<h2 id="746">7.4.6 部署异构资源集群管理系统实验<a class="headerlink" href="#746" title="Permanent link">&para;</a></h2>
<p>请大家参考<a href="https://github.com/microsoft/AI-System/tree/main/Labs/AdvancedLabs/Lab6">AI-System Lab6</a>进行集群管理系统OpenPAI的部署练习。</p>
<p>大家通过当前实例可以练习和感受以下任务：
- 部署异构资源集群管理系统
- 监控异构资源集群管理系统
- 提交作业与监控作业
- 调整调度器配置，观察调度器的影响</p>
<h3 id="7461">7.4.6.1 实验目的<a class="headerlink" href="#7461" title="Permanent link">&para;</a></h3>
<p>以 <a href="https://github.com/microsoft/pai">Microsoft Open Platform for AI (OpenPAI)</a> 为例，学习搭建并使用面向深度学习的异构计算集群调度与资源管理系统。</p>
<h3 id="7462">7.4.6.2 实验环境<a class="headerlink" href="#7462" title="Permanent link">&para;</a></h3>
<p>本实验为分组实验，3~4 位同学一组，实验内容略有差别， 实验流程中将以 Alice, Bob, Carol, Dan 指代（3人组请忽略 Dan），每位同学的环境均为：</p>
<ul>
<li>Ubuntu 18.04 LTS</li>
<li>NVIDIA GPU (已装好驱动)</li>
<li>Docker Engine</li>
<li>nvidia-container-runtime</li>
<li>ssh and sshd</li>
<li><a href="https://github.com/microsoft/pai/releases/tag/v1.2.0">OpenPAI v1.2.0</a></li>
</ul>
<h3 id="7463">7.4.6.3 实验原理<a class="headerlink" href="#7463" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>深度学习集群管理系统</p>
<p>OpenPAI（如上面介绍的架构图）本身是基于 Kubernetes 的深度学习集群管理系统，在其基础上构建针对深度学习作业的调度器，作业框架控制器，监控与报警平台，运行时等。Kubernetes 是一个可移植的、可扩展的开源平台，用于管理容器化的工作负载和服务，可促进声明式配置和自动化。一个 Kubernetes 集群由一组被称作节点的机器组成。这些节点上运行 Kubernetes 所管理的容器化应用，集群具有至少一个主节点和至少一个工作节点。</p>
<p><strong><em>主节点</em></strong> 管理集群中的工作节点和 Pod，通常运行控制组件，对集群做出全局决策（比如调度），以及检测和响应集群事件，主要包括以下组件（更详细的功能介绍请参考<a href="https://kubernetes.io/zh/docs/concepts/overview/components/">官方文档</a>）：</p>
<ul>
<li>
<p>kube-apiserver</p>
<p>主节点上负责提供 Kubernetes API 服务的组件。</p>
</li>
<li>
<p>etcd</p>
</li>
</ul>
<p>etcd 是兼具一致性和高可用性的键值数据库，可以作为保存 Kubernetes 所有集群数据的后台数据库。</p>
<ul>
<li>kube-scheduler</li>
</ul>
<p>主节点上的组件，该组件监视那些新创建的未指定运行节点的 Pod，并选择节点让 Pod 在上面运行。</p>
<ul>
<li>kube-controller-manager</li>
</ul>
<p>在主节点上运行控制器的组件。</p>
<ul>
<li>cloud-controller-manager</li>
</ul>
<p>与 kube-controller-manager 类似，cloud-controller-manager 将嵌入特定云平台的控制逻辑，在主节点上运行的云服务器控制器的组件。</p>
<p><strong><em>工作节点</em></strong> 托管作为应用程序组件的 Pod，维护运行的 Pod 并提供 Kubernetes 运行环境，主要包括以下组件：
- kubelet</p>
<div class="codehilite"><pre><span></span><code>kubelet 是一个在集群中每个节点上运行的代理，保证容器都运行在 Pod 中。
</code></pre></div>

<ul>
<li>
<p>kube-proxy</p>
<p>kube-proxy 是集群中每个节点上运行的网络代理，维护节点上的网络规则。</p>
</li>
<li>
<p>Container Runtime</p>
<p>容器运行环境是负责运行容器的软件，例如 Docker.
  <center> <img src="./img/4/7-4-4-components-of-kubernetes.svg" ch="500" width="700" height="500" /></center>
  <center>图7-4-7. Kuberenetes控制平面组件（Control Plane Components） 
 (<a href="https://kubernetes.io/zh/docs/concepts/overview/components">图片引用</a>)</center></p>
</li>
</ul>
</li>
<li>
<p><a href="https://www.usenix.org/system/files/osdi20-zhao_hanyu.pdf">HiveD</a> 调度器（Scheduler）与调度算法（Scheduling Algorithm）</p>
<p>HiveD 调度器（Scheduler） 是一个适用于多租户 GPU 集群的 Kubernetes 调度器扩展（Scheduler Extender）. 多租户 GPU 群集假定多个租户（团队）在单个物理集群（Physical Cluster）中共享同一 GPU 池，并为每个租户提供一些资源保证。HiveD 将每个租户创建一个虚拟集群（Virtual Cluster），以便每个租户可以像使用私有群集一样使用自己的虚拟集群 VC，同时还可以较低优先级地使用其他租户 VC 的空闲资源。</p>
<p>HiveD 为 VC 提供资源保证，不仅是资源的数量保证，还提供资源拓扑结构的保证。例如，传统的调度算法可以确保 VC 使用 8 块 GPU，但是它不知道这 8 块 GPU 的拓扑结构，即使在其 VC 仍有 8 个空闲 GPU 的情况下也可能因为这些 GPU 在不同的机器上，无法分配在单个机器上运行的 8 卡训练任务。HiveD 可以为 VC 提供 GPU 拓扑结构的保证，例如保证 VC 可以使用在同一个机器上的 8 块 GPU.</p>
<p>HiveD 通过 单元格（Cell） 单元来分配资源，一个 单元格（Cell） 单元包含用户自定义的资源数量和硬件的拓扑结构信息。例如用户可以定义一个包含 8 GPU 的节点，并把一个这样的 单元格（Cell） 分配给 VC，这样 HiveD 可以保证该 VC 一定有一个可分配的 8 GPU 机器，不管其它 VC 的资源分配情况怎样。HiveD 支持灵活的（单元格（Cell） 单元定义，来保证细粒度的资源分配。例如，用户可以针对不同的 AI 硬件（例如 NVIDIA V100, AMD MI50, Google Cloud TPU v3）或网络配置（例如 InfiniBand）在多个拓扑层级（例如 PCIe switch, NUMA）定义 单元格（Cell） 单元。VC 可以包含各种层级的 单元格（Cell） 单元，HiveD 可以保证所有 单元格（Cell） 单元的资源。</p>
</li>
</ol>
<h3 id="7464">7.4.6.4 实验内容<a class="headerlink" href="#7464" title="Permanent link">&para;</a></h3>
<p><strong><em>实验流程图</em></strong></p>
<p><center> <img src="./img/6/Lab6-flow.png" ch="500" width="400" height="500" /></center>
<center>图7-6-5. 实验流程图(<a href="">图片来源</a>)</center></p>
<p><strong><em>具体步骤</em></strong></p>
<ol>
<li>
<p>安装环境依赖</p>
<p>（以下步骤在 Alice, Bob, Carol, Dan 的机器上执行）</p>
<ol>
<li>
<p>安装 Docker Engine</p>
<p>参照 <a href="https://docs.docker.com/engine/install/ubuntu/">Docker Engine 文档</a> 在 Ubuntu 上安装 Docker Engine.</p>
</li>
<li>
<p>安装NVIDIA容器运行时 nvidia-container-runtime</p>
<p>参照 <a href="https://github.com/NVIDIA/nvidia-container-runtime#installation">Installation 文档</a> 在 Ubuntu 上安装 nvidia-container-time</p>
<p>参照<a href="https://github.com/NVIDIA/nvidia-container-runtime#daemon-configuration-file">文档</a> 修改 Docker daemon 配置文件，将 <code>default-runtime</code> 设为 <code>nvidia</code>，配置文件修改后需要使用 <code>sudo systemctl restart docker</code> 重启 Docker daemon.</p>
</li>
<li>
<p>验证安装结果</p>
<ul>
<li>通过 <code>sudo docker info</code> 检查是否有 "Default runtime: nvidia" （默认为 runc）.</li>
<li>通过 <code>sudo docker run nvidia/cuda:10.0-base nvidia-smi</code> 运行一个 GPU Docker 看是否能正确看到 GPU 信息。</li>
</ul>
</li>
<li>
<p>新建 Linux 用户</p>
<p>新建相同的 Linux 用户，例如 username: openpai, password: paiopen, 并将该用户加到 sudo 组里。</p>
<div class="highlight"><pre><span></span><code>sudo useradd openpai
sudo usermod -a -G sudo openpai
</code></pre></div>
</li>
</ol>
</li>
<li>
<p>部署 OpenPAI</p>
<p>在部署的集群中：Alice 的机器为 dev-box（管理员用来操作集群，不在集群中），Bob 的机器为 master（在集群中，不跑具体的任务），Carol 和 Dan 的机器为 worker（在集群中，用来跑用户的任务）。</p>
<p>（以下步骤只在 Alice 的机器上执行）</p>
<ol>
<li>
<p>准备配置文件</p>
<ul>
<li>
<p><code>~/master.csv</code>:</p>
<div class="highlight"><pre><span></span><code>hostname-bob,10.0.1.2
</code></pre></div>
<p>"hostname-bob" 是在 Bob 的机器上执行 <code>hostname</code> 的结果，10.0.1.2 替换为 Bob 的机器的 ip 地址。</p>
</li>
<li>
<p><code>~/worker.csv</code>:</p>
<div class="highlight"><pre><span></span><code>hostname-carol,10.0.1.3
hostname-dan,10.0.1.4
</code></pre></div>
<p>"hostname-carol" 是在 Carol 的机器上执行 <code>hostname</code> 的结果，10.0.1.3 替换为 Carol 的机器的 ip 地址。Dan 同理。</p>
</li>
<li>
<p><code>~/config.yaml</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openpai</span><span class="w"></span>
<span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">paiopen</span><span class="w"></span>
<span class="nt">branch_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1.2.0</span><span class="w"></span>
<span class="nt">docker_image_tag</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1.2.0</span><span class="w"></span>
</code></pre></div>
<p>"user" 和 "password" 是新建的 Linux 用户的 username 和 password.</p>
</li>
</ul>
</li>
<li>
<p>部署 OpenPAI</p>
<ol>
<li>
<p>克隆 OpenPAI 的代码</p>
<div class="highlight"><pre><span></span><code>git clone -b v1.2.0 https://github.com/microsoft/pai.git
<span class="nb">cd</span> pai/contrib/kubespray
</code></pre></div>
</li>
<li>
<p>部署 Kubernetes</p>
<div class="highlight"><pre><span></span><code>bash quick-start-kubespray.sh -m ~/master.csv -w ~/worker.csv -c ~/config.yaml
</code></pre></div>
</li>
<li>
<p>启动 OpenPAI 服务</p>
<div class="highlight"><pre><span></span><code>bash quick-start-service.sh -m ~/master.csv -w ~/worker.csv -c ~/config.yaml
</code></pre></div>
</li>
</ol>
<p>如果部署成功，会看到如下信息：
<div class="highlight"><pre><span></span><code>Kubernetes cluster config :     ~/pai-deploy/kube/config
OpenPAI cluster config    :     ~/pai-deploy/cluster-cfg
OpenPAI cluster ID        :     pai
Default username          :     admin
Default password          :     admin-password

You can go to http://&lt;your-master-ip&gt;, then use the default username and password to log in.
</code></pre></div></p>
<p>在浏览器中访问 <a href="http://bob-ip">http://bob-ip</a>，使用 admin 和 admin-password 登陆。</p>
</li>
<li>
<p>运行 dev-box Docker 管理集群</p>
<p>运行 dev-box Docker 容器：
<div class="highlight"><pre><span></span><code>sudo docker run -itd <span class="se">\</span>
    -v /var/run/docker.sock:/var/run/docker.sock <span class="se">\</span>
    -v <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/pai-deploy/cluster-cfg:/cluster-configuration  <span class="se">\</span>
    -v <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/pai-deploy/kube:/root/.kube <span class="se">\</span>
    --privileged<span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
    --name<span class="o">=</span>dev-box <span class="se">\</span>
    openpai/dev-box:v1.2.0
</code></pre></div></p>
<p>执行 dev-box Docker 容器：
<div class="highlight"><pre><span></span><code>sudo docker <span class="nb">exec</span> -it dev-box bash
</code></pre></div></p>
<p>列出集群中的节点：
<div class="highlight"><pre><span></span><code>kubectl get nodes
</code></pre></div></p>
<p>使用 <code>paictl</code> 管理 OpenPAI 服务：
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> /pai
python paictl.py config get-id
</code></pre></div></p>
</li>
</ol>
<blockquote>
<p>注：详细的部署说明请参考 <a href="https://openpai.readthedocs.io/en/latest/manual/cluster-admin/installation-guide.html#installation-from-scratch">Installation Guide</a>，部署过程中遇到的问题可以参考 <a href="https://openpai.readthedocs.io/en/latest/manual/cluster-admin/installation-faqs-and-troubleshooting.html#troubleshooting">troubleshooting</a> 或在 <a href="https://github.com/microsoft/pai/issues">GitHub issue</a> 上提问。</p>
</blockquote>
</li>
<li>
<p>使用 OpenPAI</p>
<ol>
<li>
<p>新建 OpenPAI 用户</p>
<p>（Bob 执行）</p>
<p>Bob 访问 <a href="http://bob-ip">http://bob-ip</a>, 在 Administration -&gt; User Management 页面中，给 Alice, Carol, Dan 分别新建账号。</p>
</li>
<li>
<p>提交集群任务</p>
<p>（Alice, Bob, Carol, Dan 都执行）</p>
<p>在浏览器中访问 <a href="http://bob-ip">http://bob-ip</a>, 在 Submit Job 页面提交 Single Job。观察集群中任务的等待和执行情况。</p>
</li>
</ol>
</li>
<li>
<p>更改调度器配置并使用不同调度策略</p>
<ol>
<li>
<p>更改调度器配置</p>
<p>（Alice 执行）</p>
<p>将两个 GPU 机器配置成两个不同的 VC，在 dev-box Docker 容器中更改 <code>/cluster-configuration/service-configuration.yaml</code> 文件中的 <code>hivedscheduler</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nt">hivedscheduler</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w"></span>
<span class="w">    </span><span class="no">physicalCluster:</span><span class="w"></span>
<span class="w">      </span><span class="no">skuTypes:</span><span class="w"></span>
<span class="w">        </span><span class="no">GPU-C:</span><span class="w"></span>
<span class="w">          </span><span class="no">gpu: 1</span><span class="w"></span>
<span class="w">          </span><span class="no">cpu: 2</span><span class="w"></span>
<span class="w">          </span><span class="no">memory: 4096Mi</span><span class="w"></span>
<span class="w">        </span><span class="no">GPU-D:</span><span class="w"></span>
<span class="w">          </span><span class="no">gpu: 1</span><span class="w"></span>
<span class="w">          </span><span class="no">cpu: 2</span><span class="w"></span>
<span class="w">          </span><span class="no">memory: 4096Mi</span><span class="w"></span>
<span class="w">      </span><span class="no">cellTypes:</span><span class="w"></span>
<span class="w">        </span><span class="no">GPU-C-NODE:</span><span class="w"></span>
<span class="w">          </span><span class="no">childCellType: GPU-C</span><span class="w"></span>
<span class="w">          </span><span class="no">childCellNumber: 1</span><span class="w"></span>
<span class="w">          </span><span class="no">isNodeLevel: true</span><span class="w"></span>
<span class="w">        </span><span class="no">GPU-C-NODE-POOL:</span><span class="w"></span>
<span class="w">          </span><span class="no">childCellType: GPU-C-NODE</span><span class="w"></span>
<span class="w">          </span><span class="no">childCellNumber: 1</span><span class="w"></span>
<span class="w">        </span><span class="no">GPU-D-NODE:</span><span class="w"></span>
<span class="w">          </span><span class="no">childCellType: GPU-D</span><span class="w"></span>
<span class="w">          </span><span class="no">childCellNumber: 1</span><span class="w"></span>
<span class="w">          </span><span class="no">isNodeLevel: true</span><span class="w"></span>
<span class="w">        </span><span class="no">GPU-D-NODE-POOL:</span><span class="w"></span>
<span class="w">          </span><span class="no">childCellType: GPU-D-NODE</span><span class="w"></span>
<span class="w">          </span><span class="no">childCellNumber: 1</span><span class="w"></span>
<span class="w">      </span><span class="no">physicalCells:</span><span class="w"></span>
<span class="w">      </span><span class="no">- cellType: GPU-C-NODE-POOL</span><span class="w"></span>
<span class="w">        </span><span class="no">cellChildren:</span><span class="w"></span>
<span class="w">        </span><span class="no">- cellAddress: hostname-carol #TODO change to Carol&#39;s</span><span class="w"></span>
<span class="w">      </span><span class="no">- cellType: GPU-D-NODE-POOL</span><span class="w"></span>
<span class="w">        </span><span class="no">cellChildren:</span><span class="w"></span>
<span class="w">        </span><span class="no">- cellAddress: hostname-dan #TODO change to Dan&#39;s</span><span class="w"></span>
<span class="w">    </span><span class="no">virtualClusters:</span><span class="w"></span>
<span class="w">      </span><span class="no">default:</span><span class="w"></span>
<span class="w">        </span><span class="no">virtualCells:</span><span class="w"></span>
<span class="w">        </span><span class="no">- cellType: GPU-C-NODE-POOL.GPU-C-NODE</span><span class="w"></span>
<span class="w">          </span><span class="no">cellNumber: 1</span><span class="w"></span>
<span class="w">      </span><span class="no">vc1:</span><span class="w"></span>
<span class="w">        </span><span class="no">virtualCells:</span><span class="w"></span>
<span class="w">        </span><span class="no">- cellType: GPU-D-NODE-POOL.GPU-D-NODE</span><span class="w"></span>
<span class="w">          </span><span class="no">cellNumber: 1</span><span class="w"></span>
</code></pre></div>
<p>然后使用 <code>paictl</code> 更新配置文件并重启相应的服务（提示输入的 cluster-id 为 "pai"）：</p>
<div class="highlight"><pre><span></span><code>python paictl.py service stop -n rest-server hivedscheduler
python paictl.py config push -p /cluster-configuration -m service
python paictl.py service start -n rest-server hivedscheduler
</code></pre></div>
</li>
<li>
<p>虚拟集群安全（VC） 安全 (VC Safety)</p>
<p>（Alice, Bob, Carol, Dan 都执行，可同时进行）</p>
<p>同时向 <code>vc1</code> 提交任务（任务配置文件可参考 <code>job-config-0.yaml</code>），观察任务的运行情况：提交的任务会在哪个机器上运行，当有多个任务在等待并且集群中的 <code>default</code> VC 空闲时任务会被怎样调度？</p>
</li>
<li>
<p>优先级和抢占 (Priority and Preemption)</p>
<p>（Alice, Bob, Carol, Dan 按顺序依次实验，实验时确保集群中没有其它未结束的任务）</p>
<p>先向 <code>vc1</code> 提交一个优先级 <code>jobPriorityClass</code> 为 <code>test</code> 的任务（任务配置文件可参考 <code>job-config-1.yaml</code>），在其运行时再向 <code>vc1</code> 提交一个优先级为 <code>prod</code> 的任务（任务配置文件可参考 <code>job-config-2.yaml</code>），观察任务的运行情况：后提交的任务是否在先提交的任务运行完成之后运行，什么时候两个任务都运行结束？</p>
</li>
<li>
<p>低优先级任务 ，也叫机会任务(Opportunistic Job)</p>
<p>（Alice, Bob, Carol, Dan 按顺序依次实验，实验时确保集群中没有其它未结束的任务）</p>
<p>先向 <code>vc1</code> 提交一个优先级 <code>jobPriorityClass</code> 为 <code>prod</code> 的任务（任务配置文件可参考 <code>job-config-3.yaml</code>），在其运行时再向 <code>vc1</code> 提交一个优先级为 <code>oppo</code>（最低优先级）的任务（任务配置文件可参考 <code>job-config-4.yaml</code>），观察任务的运行情况：后提交的任务什么时候开始运行，是否会等高优先级的任务运行完？如果在后提交的任务运行时再向 <code>default</code> VC 提交优先级为 <code>test</code> 的任务会被怎样调度？</p>
</li>
<li>
<p>更改调度器配置</p>
<p>（Alice 执行）</p>
<p>将两个 GPU 机器配置在相同 VC 里，在 dev-box Docker 容器中更改 <code>/cluster-configuration/service-configuration.yaml</code> 文件中的 <code>hivedscheduler</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nt">hivedscheduler</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w"></span>
<span class="w">    </span><span class="no">physicalCluster:</span><span class="w"></span>
<span class="w">      </span><span class="no">skuTypes:</span><span class="w"></span>
<span class="w">        </span><span class="no">GPU:</span><span class="w"></span>
<span class="w">          </span><span class="no">gpu: 1</span><span class="w"></span>
<span class="w">          </span><span class="no">cpu: 2</span><span class="w"></span>
<span class="w">          </span><span class="no">memory: 4096Mi</span><span class="w"></span>
<span class="w">      </span><span class="no">cellTypes:</span><span class="w"></span>
<span class="w">        </span><span class="no">GPU-NODE:</span><span class="w"></span>
<span class="w">          </span><span class="no">childCellType: GPU</span><span class="w"></span>
<span class="w">          </span><span class="no">childCellNumber: 1</span><span class="w"></span>
<span class="w">          </span><span class="no">isNodeLevel: true</span><span class="w"></span>
<span class="w">        </span><span class="no">GPU-NODE-POOL:</span><span class="w"></span>
<span class="w">          </span><span class="no">childCellType: GPU-NODE</span><span class="w"></span>
<span class="w">          </span><span class="no">childCellNumber: 2</span><span class="w"></span>
<span class="w">      </span><span class="no">physicalCells:</span><span class="w"></span>
<span class="w">      </span><span class="no">- cellType: GPU-NODE-POOL</span><span class="w"></span>
<span class="w">        </span><span class="no">cellChildren:</span><span class="w"></span>
<span class="w">        </span><span class="no">- cellAddress: hostname-carol #TODO change to Carol&#39;s</span><span class="w"></span>
<span class="w">        </span><span class="no">- cellAddress: hostname-dan #TODO change to Dan&#39;s</span><span class="w"></span>
<span class="w">    </span><span class="no">virtualClusters:</span><span class="w"></span>
<span class="w">      </span><span class="no">default:</span><span class="w"></span>
<span class="w">        </span><span class="no">virtualCells:</span><span class="w"></span>
<span class="w">        </span><span class="no">- cellType: GPU-NODE-POOL.GPU-NODE</span><span class="w"></span>
<span class="w">          </span><span class="no">cellNumber: 2</span><span class="w"></span>
</code></pre></div>
<p>然后使用 <code>paictl</code> 更新配置文件并重启相应的服务（提示输入的 cluster-id 为 "pai"）：</p>
<div class="highlight"><pre><span></span><code>python paictl.py service stop -n rest-server hivedscheduler
python paictl.py config push -p /cluster-configuration -m service
python paictl.py service start -n rest-server hivedscheduler
</code></pre></div>
</li>
<li>
<p>群调度 (Gang Scheduling)</p>
<p>（Alice, Bob, Carol, Dan 按顺序依次实验，实验时确保集群中没有其它未结束的任务）</p>
<p>先向 <code>default</code> VC 提交一个任务占用一台机器（任务配置文件可参考 <code>job-config-5.yaml</code>），在其运行时再向 <code>default</code> VC 提交一个有 2 个子任务需要两台机器的任务（任务配置文件可参考 <code>job-config-6.yaml</code>），观察任务的运行情况：后提交的任务什么时候开始运行，2 个子任务是否会先后运行？</p>
</li>
<li>
<p>增量调度 (Incremental Scheduling)</p>
<p>（Alice, Bob, Carol, Dan 按顺序依次实验，实验时确保集群中没有其它未结束的任务）</p>
<p>先向 <code>default</code> VC 提交一个任务占用一台机器，在其运行时再向 <code>default</code> VC 提交一个有 2 个子任务需要两台机器的任务（任务配置文件可参考 <code>job-config-7.yaml</code>），观察任务的运行情况：后提交的任务什么时候开始运行，2 个子任务是否会先后运行？能否在当前只有 2 GPU 的集群中提交一个需要用超过配额（例如用 4 GPU）的任务？</p>
</li>
</ol>
</li>
</ol>
<h3 id="7465">7.4.6.5 实验报告<a class="headerlink" href="#7465" title="Permanent link">&para;</a></h3>
<p><strong><em>实验环境</em></strong></p>
<p>（Alice/Bob/Carol/Dan 替换为组员姓名）
|||||||
|-------|-|-------|-----|------|------|
| Users | | &nbsp; &nbsp; &nbsp; &nbsp; Alice &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; Bob &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; Carol &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; Dan &nbsp; &nbsp; &nbsp; &nbsp; |
| 硬件环境 | CPU（vCPU数目）||||||
|| GPU(型号，数目) |||||
|| IP |||||
|| HostName |||||
| 软件环境 | OS版本 |||||
|| Docker Engine版本 |||||
|| CUDA版本 |||||
|| OpenPAI版本 |||||
|||||||</p>
<p><strong><em>实验结果</em></strong></p>
<ol>
<li>
<p>部署 OpenPAI</p>
<p>简述部署中遇到的问题以及相应的解决方案。</p>
</li>
<li>
<p>使用不同调度策略
     ||||
     | --- | --- | --- |
     | 实验名称 | 实验现象（任务运行情况） | 支持文件（任务配置文件, UI 截图等） |
     | 虚拟集群（VC） 安全 (VC Safety) | 提交的任务会在哪个机器上运行，当有多个任务在等待并且集群中的 <code>default</code> VC 空闲时任务会被怎样调度？其它观察到的现象 | |
     | 优先级和抢占 (Priority and Preemption) | 后提交的任务是否在先提交的任务运行完成之后运行，什么时候两个任务都运行结束？其它观察到的现象 | |
     | 机会任务 (Opportunistic Job) | 后提交的任务什么时候开始运行，是否会等高优先级的任务运行完？如果在后提交的任务运行时再向 <code>default</code> VC 提交优先级为 <code>test</code> 的任务会被怎样调度？其它观察到的现象 | |
     | 群调度 (Gang Scheduling) | 后提交的任务什么时候开始运行，2 个子任务是否会先后运行？其它观察到的现象 | |
     | 增量调度 (Incremental Scheduling) | 后提交的任务什么时候开始运行，2 个子任务是否会先后运行？能否在当前只有 2 GPU 的集群中提交一个需要用超过配额（例如用 4 GPU）的任务？其它观察到的现象 | |
     ||||</p>
</li>
</ol>
<p><strong><em>参考代码</em></strong></p>
<p>代码位置：<code>AI-System/Labs/AdvancedLabs/Lab6/config/</code></p>
<h2 id="_3">小结与讨论<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p>本章我们主要介绍异构计算集群管理系统的面向深度学习的异构集群管理系统，这其中会利用深度学习负载的特点，底层硬件的拓扑，从中间系统层去发掘新的问题和优化机会。</p>
<p>请读者思考，当前算法有哪些较强的假设，你面对的环境是否能够提供？</p>
<h2 id="_4">参考文献<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://github.com/microsoft/pai">https://github.com/microsoft/pai</a></li>
<li><a href="https://www.kubeflow.org/">https://www.kubeflow.org/</a></li>
<li><a href="https://dl.acm.org/doi/10.5555/3358807.3358888">Myeongjae Jeon, Shivaram Venkataraman, Amar Phanishayee, unjie Qian, Wencong Xiao, and Fan Yang. 2019. Analysis of large-scale multi-tenant GPU clusters for DNN training workloads. In Proceedings of the 2019 USENIX Conference on Usenix Annual Technical Conference (USENIX ATC '19). USENIX Association, USA, 947–960.</a></li>
<li><a href="https://dl.acm.org/doi/10.1145/3377811.3380362">Ru Zhang, Wencong Xiao, Hongyu Zhang, Yu Liu, Haoxiang Lin, and Mao Yang. 2020. An empirical study on program failures of deep learning jobs. In Proceedings of the ACM/IEEE 42<sup>nd</sup> International Conference on Software Engineering (ICSE '20). Association for Computing Machinery, New York, NY, USA, 1159–1170. DOI:https://doi.org/10.1145/3377811.3380362</a></li>
<li><a href="https://dl.acm.org/doi/10.5555/3291168.3291212">Wencong Xiao, Romil Bhardwaj, Ramachandran Ramjee, Muthian Sivathanu, Nipun Kwatra, Zhenhua Han, Pratyush Patel, Xuan Peng, Hanyu Zhao, Quanlu Zhang, Fan Yang, and Lidong Zhou. 2018. Gandiva: introspective cluster scheduling for deep learning. In Proceedings of the 13<sup>th</sup> USENIX conference on Operating Systems Design and Implementation (OSDI'18). USENIX Association, USA, 595–610.</a></li>
<li><a href="https://dl.acm.org/doi/10.5555/3488766.3488795">Hanyu Zhao, Zhenhua Han, Zhi Yang, Quanlu Zhang, Fan Yang, Lidong Zhou, Mao Yang, Francis C.M. Lau, Yuqi Wang, Yifan Xiong, and Bin Wang. 2020. HiveD: sharing a GPU cluster for deep learning with guarantees. Proceedings of the 14<sup>th</sup> USENIX Conference on Operating Systems Design and Implementation. Article 29, 515–532.</a></li>
<li><a href="https://www.msra.cn/zh-cn/news/features/openpai">https://www.msra.cn/zh-cn/news/features/openpai</a></li>
<li><a href="https://arxiv.org/abs/2202.07848">Singularity: Planet-Scale, Preemptive and Elastic Scheduling of AI Workloads</a></li>
<li><a href="https://ieeexplore.ieee.org/abstract/document/7056044">D. Tiwari et al., "Understanding GPU errors on large-scale HPC systems and the implications for system design and operation," 2015 IEEE 21<sup>st</sup> International Symposium on High Performance Computer Architecture (HPCA), 2015, pp. 331-342, doi: 10.1109/HPCA.2015.7056044.</a></li>
<li><a href="https://www.usenix.org/conference/osdi20/presentation/xiao">Wencong Xiao, Shiru Ren, Yong Li, Yang Zhang, Pengyang Hou, Zhi Li, Yihui Feng, Wei Lin, and Yangqing Jia. 2020. AntMan: dynamic scaling on GPU clusters for deep learning. Proceedings of the 14<sup>th</sup> USENIX Conference on Operating Systems Design and Implementation. USENIX Association, USA, Article 30, 533–548.</a></li>
<li><a href="https://dl.acm.org/doi/10.5555/3323234.3323274">Juncheng Gu, Mosharaf Chowdhury, Kang G. Shin, Yibo Zhu, Myeongjae Jeon, Junjie Qian, Hongqiang Liu, and Chuanxiong Guo. 2019. Tiresias: a GPU cluster manager for distributed deep learning. In Proceedings of the 16<sup>th</sup> USENIX Conference on Networked Systems Design and Implementation (NSDI'19). USENIX Association, USA, 485–500.</a></li>
<li><a href="https://arxiv.org/abs/2202.07848">Shukla, D., Sivathanu, M., Viswanatha, S., Gulavani, B.S., Nehme, R.V., Agrawal, A., Chen, C., Kwatra, N., Ramjee, R., Sharma, P., Katiyar, A., Modi, V., Sharma, V., Singh, A., Singhal, S., Welankar, K., Xun, L., Anupindi, R., Elangovan, K., Rahman, H., Lin, Z., Seetharaman, R., Xu, C., Ailijiang, E., Krishnappa, S., &amp; Russinovich, M. (2022). Singularity: Planet-Scale, Preemptive and Elastic Scheduling of AI Workloads. ArXiv, abs/2202.07848.</a></li>
<li><a href="https://techcommunity.microsoft.com/t5/azure-compute-blog/singularity-on-azure-containers-for-hpc/ba-p/464174">https://techcommunity.microsoft.com/t5/azure-compute-blog/singularity-on-azure-containers-for-hpc/ba-p/464174</a> </li>
<li><a href="https://doi.org/10.1145/3190508.3190517">Yanghua Peng, Yixin Bao, Yangrui Chen, Chuan Wu, and Chuanxiong Guo. 2018. Optimus: an efficient dynamic resource scheduler for deep learning clusters. In Proceedings of the Thirteenth EuroSys Conference (EuroSys '18). Association for Computing Machinery, New York, NY, USA, Article 3, 1–14.</a></li>
<li><a href="https://github.com/microsoft/AI-System/tree/main/Labs/AdvancedLabs/Lab6">https://github.com/microsoft/AI-System/tree/main/Labs/AdvancedLabs/Lab6</a></li>
<li>Open Platform for AI (OpenPAI): <a href="https://github.com/microsoft/pai">https://github.com/microsoft/pai</a></li>
<li>OpenPAI Handbook: <a href="https://openpai.readthedocs.io/en/latest/">https://openpai.readthedocs.io/en/latest/</a></li>
<li>HiveD Scheduler: <a href="https://github.com/microsoft/hivedscheduler">https://github.com/microsoft/hivedscheduler</a></li>
<li>Kubernetes Documentation: <a href="https://kubernetes.io/docs/home/">https://kubernetes.io/docs/home/</a></li>
</ul>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../7.3-%E8%B0%83%E5%BA%A6/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 7.3-调度" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              7.3-调度
            </div>
          </div>
        </a>
      
      
        
        <a href="../7.6-%E5%BC%80%E5%8F%91%E4%B8%8E%E8%BF%90%E7%BB%B4/" class="md-footer__link md-footer__link--next" aria-label="Next: 7.6-开发与运维" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              7.6-开发与运维
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs"], "search": "../../../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.0238f547.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/gh/rod2ik/cdn@main/mkdocs/javascripts/mkdocs-graphviz.js"></script>
      
        <script src="https://cdnjs.loli.net/ajax/libs/pangu/3.3.0/pangu.min.js"></script>
      
        <script src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>